/*Import Train*/
Data train;
infile '/home/rfarhanian0/ES-2/projects/1/dataset/moneyball.csv' dlm=',' dsd firstobs=2 ;
input INDEX TARGET_WINS TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B TEAM_BATTING_HR
TEAM_BATTING_BB TEAM_BATTING_SO TEAM_BASERUN_SB TEAM_BASERUN_CS TEAM_BATTING_HBP TEAM_PITCHING_H
TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO TEAM_FIELDING_E TEAM_FIELDING_DP;
run;

/*Import Test*/
Data test;
infile '/home/rfarhanian0/ES-2/projects/1/dataset/moneyball.csvmoneyball_test.csv' dlm=',' dsd firstobs=2 ;
input INDEX TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B TEAM_BATTING_HR
TEAM_BATTING_BB TEAM_BATTING_SO TEAM_BASERUN_SB TEAM_BASERUN_CS TEAM_BATTING_HBP TEAM_PITCHING_H
TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO TEAM_FIELDING_E TEAM_FIELDING_DP;
run;

data train1;
set train;
	if TARGET_WINS = 0 then TARGET_WINS = 20;
	if TARGET_WINS <20 then TARGET_WINS= 80;
	if TARGET_WINS > 116 then TARGET_WINS = 80;
	if TEAM_BATTING_2B <110 then TEAM_BATTING_2B = 110;
	if TEAM_BATTING_2B > 383 then TEAM_BATTING_2B = 383;
	if TEAM_BATTING_3B > 153 then TEAM_BATTING_3B = 55;
	if TEAM_BATTING_3B < 11 then TEAM_BATTING_3B = 55;
	if TEAM_BATTING_HR = 0 then TEAM_BATTING_HR = 101;
	if TEAM_BATTING_HR > 3 and TEAM_BATTING_HR < 9 then TEAM_BATTING_HR = 101;
	if TEAM_BATTING_BB < 283 then TEAM_BATTING_BB = 521;
	if TEAM_BATTING_BB > 835 then TEAM_BATTING_BB =835;
	if TEAM_BATTING_SO = . or TEAM_BATTING_SO < 308 then TEAM_BATTING_SO = 757;
	if TEAM_BATTING_SO >308 and TEAM_BATTING_SO < 326 then TEAM_BATTING_SO = 757;
	if TEAM_BASERUN_SB < 13 then TEAM_BASERUN_SB = 13;
	if TEAM_BASERUN_SB > 581 then TEAM_BASERUN_SB = 581;
	if TEAM_BASERUN_SB = . then TEAM_BASERUN_SB =  123;
	if TEAM_FIELDING_E > 867 then TEAM_FIELDING_E = 218;
	if TEAM_PITCHING_SO = . then TEAM_PITCHING_SO = 799.668;
	if TEAM_FIELDING_DP = . or TEAM_FIELDING_DP >174 then TEAM_FIELDING_DP = 136;
	if TEAM_FIELDING_DP < 75 then TEAM_FIELDING_DP = 136;
	If TEAM_PITCHING_BB = 0 or TEAM_PITCHING_BB > 961 then TEAM_PITCHING_BB = 547;
	if TEAM_PITCHING_HR <3 or TEAM_PITCHING_HR > 50 then TEAM_PITCHING_HR=30;
	if TEAM_PITCHING_SO <308 or TEAM_PITCHING_SO > 1529 then TEAM_PITCHING_SO = 802;
	drop TEAM_BATTING_HBP;
	drop TEAM_BASERUN_CS;
run;
quit;

proc corr data=train1;
var TARGET_WINS TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B TEAM_BATTING_HR
TEAM_BATTING_BB TEAM_BATTING_SO TEAM_BASERUN_SB TEAM_PITCHING_H
TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO TEAM_FIELDING_E TEAM_FIELDING_DP;
run;

PROC CONTENTS DATA=train1; RUN;
proc means data=train N NMISS MEAN STD MAX MIN MEDIAN P25 P75 P90 CV; run;
proc means data=train1 N NMISS MEAN STD MAX MIN MEDIAN P25 P75 P90 CV; run;

proc means data=test;
run;

data test1;
set test;
	if TARGET_WINS = 0 then TARGET_WINS = 20;
	if TARGET_WINS <20 then TARGET_WINS= 80;
	if TARGET_WINS > 116 then TARGET_WINS = 80;
	if TEAM_BATTING_2B <110 then TEAM_BATTING_2B = 110;
	if TEAM_BATTING_2B > 383 then TEAM_BATTING_2B = 383;
	if TEAM_BATTING_3B > 153 then TEAM_BATTING_3B = 55;
	if TEAM_BATTING_3B < 11 then TEAM_BATTING_3B = 55;
	if TEAM_BATTING_HR = 0 then TEAM_BATTING_HR = 101;
	if TEAM_BATTING_HR > 3 and TEAM_BATTING_HR < 9 then TEAM_BATTING_HR = 101;
	if TEAM_BATTING_BB < 283 then TEAM_BATTING_BB = 521;
	if TEAM_BATTING_BB > 835 then TEAM_BATTING_BB =835;
	if TEAM_BATTING_SO = . or TEAM_BATTING_SO < 308 then TEAM_BATTING_SO = 757;
	if TEAM_BATTING_SO >308 and TEAM_BATTING_SO < 326 then TEAM_BATTING_SO = 757;
	if TEAM_BASERUN_SB < 13 then TEAM_BASERUN_SB = 13;
	if TEAM_BASERUN_SB > 581 then TEAM_BASERUN_SB = 581;
	if TEAM_BASERUN_SB = . then TEAM_BASERUN_SB =  123;
	if TEAM_FIELDING_E > 867 then TEAM_FIELDING_E = 218;
	if TEAM_PITCHING_SO = . then TEAM_PITCHING_SO = 799.668;
	if TEAM_FIELDING_DP = . or TEAM_FIELDING_DP >174 then TEAM_FIELDING_DP = 136;
	if TEAM_FIELDING_DP < 75 then TEAM_FIELDING_DP = 136;
	If TEAM_PITCHING_BB = 0 or TEAM_PITCHING_BB > 961 then TEAM_PITCHING_BB = 547;
	if TEAM_PITCHING_HR <3 or TEAM_PITCHING_HR > 50 then TEAM_PITCHING_HR=30;
	if TEAM_PITCHING_SO <308 or TEAM_PITCHING_SO > 1529 then TEAM_PITCHING_SO = 802;
	drop TEAM_BATTING_HBP;
	drop TEAM_BASERUN_CS;
run;
quit;

PROC CONTENTS DATA=test1; RUN;

proc means data=test1; run;

Proc univariate data=train1;
var TARGET_WINS TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B TEAM_BATTING_HR
TEAM_BATTING_BB TEAM_BATTING_SO TEAM_BASERUN_SB TEAM_PITCHING_H
TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO TEAM_FIELDING_E TEAM_FIELDING_DP;
histogram;
RUN;

data clean_train;
set train1;
LOG_TEAM_BATTING_H=LOG(TEAM_BATTING_H);
LOG_TEAM_BATTING_3B=LOG(ABS(TEAM_BATTING_3B)+1);
SQRT_TEAM_BATTING_3B=SQRT(TEAM_BATTING_3B);
LOG_TEAM_BATTING_HR=LOG(ABS(TEAM_BATTING_HR)+1);
SQRT_TEAM_BATTING_HR=SQRT(TEAM_BATTING_HR);
LOG_TEAM_BASERUN_SB=LOG(ABS(TEAM_BASERUN_SB)+1);
SQRT_TEAM_BASERUN_SB=SQRT(TEAM_BASERUN_SB);
LOG_TEAM_FIELDING_E=LOG(TEAM_FIELDING_E);
SQRT_TEAM_FIELDING_E=SQRT(IMP_FIELDING_E);
LOG_TEAM_PITCHING_H=LOG(TEAM_PITCHING_H);
SQRT_TEAM_PITCHING_H=SQRT(TEAM_PITCHING_H);
LOG_TEAM_PITCHING_HR=LOG(ABS(TEAM_PITCHING_HR)+1);
SQRT_TEAM_PITCHING_HR=SQRT(TEAM_PITCHING_HR);
RUN;

Proc univariate data=clean_train;
var TARGET_WINS TEAM_BATTING_H LOG_TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B LOG_TEAM_BATTING_3B
SQRT_TEAM_BATTING_3B TEAM_BATTING_HR LOG_TEAM_BATTING_HR SQRT_TEAM_BATTING_HR
TEAM_BATTING_BB TEAM_BATTING_SO TEAM_BASERUN_SB LOG_TEAM_BASERUN_SB SQRT_TEAM_BASERUN_SB
TEAM_PITCHING_H LOG_TEAM_PITCHING_H SQRT_TEAM_PITCHING_H
TEAM_PITCHING_HR LOG_TEAM_PITCHING_HR SQRT_TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO TEAM_FIELDING_E LOG_TEAM_FIELDING_E
SQRT_TEAM_FIELDING_E TEAM_FIELDING_DP;
histogram;
RUN;

data clean_test;
set test1;
LOG_TEAM_BATTING_H=LOG(TEAM_BATTING_H);
LOG_TEAM_BATTING_3B=LOG(ABS(TEAM_BATTING_3B)+1);
SQRT_TEAM_BATTING_3B=SQRT(TEAM_BATTING_3B);
LOG_TEAM_BATTING_HR=LOG(ABS(TEAM_BATTING_HR)+1);
SQRT_TEAM_BATTING_HR=SQRT(TEAM_BATTING_HR);
LOG_TEAM_BASERUN_SB=LOG(ABS(TEAM_BASERUN_SB)+1);
SQRT_TEAM_BASERUN_SB=SQRT(TEAM_BASERUN_SB);
LOG_TEAM_FIELDING_E=LOG(TEAM_FIELDING_E);
SQRT_TEAM_FIELDING_E=SQRT(IMP_FIELDING_E);
LOG_TEAM_PITCHING_H=LOG(TEAM_PITCHING_H);
SQRT_TEAM_PITCHING_H=SQRT(TEAM_PITCHING_H);
LOG_TEAM_PITCHING_HR=LOG(ABS(TEAM_PITCHING_HR)+1);
SQRT_TEAM_PITCHING_HR=SQRT(TEAM_PITCHING_HR);
RUN;
/*create empty column for TARGET_WINS in test dataset*/
data clean_test;
set clean_test;
TARGET_WINS = .;
run;

data Mix;
set clean_train clean_test;
run;

proc glmselect data=Mix plots=all;
model TARGET_WINS=LOG_TEAM_BATTING_H TEAM_BATTING_2B LOG_TEAM_BATTING_3B
SQRT_TEAM_BATTING_HR TEAM_BATTING_BB TEAM_BATTING_SO LOG_TEAM_BASERUN_SB
TEAM_PITCHING_H TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO LOG_TEAM_FIELDING_E
TEAM_FIELDING_DP
/ selection = stepwise (stop=CV) cvmethod=random(2) hierarchy = single showpvalues;
output out = Final p=predict;
run;
data Final0;
set Final;
keep INDEX TARGET_WINS PREDICT;
RUN;
proc print data=Final0;
run;

proc glmselect data=Mix plots=all;
model TARGET_WINS=LOG_TEAM_BATTING_H TEAM_BATTING_2B LOG_TEAM_BATTING_3B
SQRT_TEAM_BATTING_HR TEAM_BATTING_BB TEAM_BATTING_SO LOG_TEAM_BASERUN_SB
TEAM_PITCHING_H TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO LOG_TEAM_FIELDING_E
TEAM_FIELDING_DP
/ selection = forward (stop=CV) cvmethod=random(2) hierarchy = single showpvalues;
output out = Final p=predict;
run;

proc glmselect data=Mix plots=all;
model TARGET_WINS=LOG_TEAM_BATTING_H TEAM_BATTING_2B LOG_TEAM_BATTING_3B
SQRT_TEAM_BATTING_HR TEAM_BATTING_BB TEAM_BATTING_SO LOG_TEAM_BASERUN_SB
TEAM_PITCHING_H TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO LOG_TEAM_FIELDING_E
TEAM_FIELDING_DP
/ selection = backward (stop=CV) cvmethod=random(2) hierarchy = single showpvalues;
output out = Final p=predict;
run;

proc glmselect data=Mix plots=all;
model TARGET_WINS=LOG_TEAM_BATTING_H TEAM_BATTING_2B LOG_TEAM_BATTING_3B
SQRT_TEAM_BATTING_HR TEAM_BATTING_BB TEAM_BATTING_SO LOG_TEAM_BASERUN_SB
TEAM_PITCHING_H TEAM_PITCHING_HR TEAM_PITCHING_BB TEAM_PITCHING_SO LOG_TEAM_FIELDING_E
TEAM_FIELDING_DP
/ selection = lasso (stop=CV) cvmethod=random(2) hierarchy = single showpvalues;
output out = Final p=predict;
run;